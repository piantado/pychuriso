---
title: "ExperimentOne"
author: "Jenna Register"
date: "January 27, 2017"
output: html_document
---

## Experiment One

Here we will be analyzing how well Churiso can capture human behavior in the "Marvin the Robot" tasks. 

```{r include=FALSE}
library(ggplot2)
library(plyr)
library(dplyr)
```

## Checking out the Human Data
```{r}
human = read.csv("human.csv", header=TRUE)
human$X <- NULL
colnames(human) = c("answer","generalization","probability","condition","frequency")

#what does the human data look like?
human$generalization <- gsub(" ","",human$generalization)
human$answer <- gsub(" ","",human$answer)
humplt = ggplot(human, aes(answer, probability, fill=as.factor(condition)))+
  geom_bar(stat="identity")+
  facet_grid(~generalization~condition)
humplt

#put the human frame into the form of the model frame
hp <- human %>% arrange(generalization) %>% as.data.frame()

hp <- hp[,c(2,4,1,3,5)]

hp

```

##Working With Overall Correlations##
```{r fig.width=15, fig.height=7}
#plot the overall correlations
correlations = read.csv("correlations.csv")
correlations=na.omit(correlations)
correlations$Legend = "Lower than .4"
correlations$Legend[correlations$cor>.4]="Higher than .4"

correlations =correlations[order(-correlations$cor),]
correlations = correlations[1:100,]
#View(correlations)


bestmodel <-correlations[correlations$cor==max(correlations$cor),]


```

##Are We Doing Better Than Random?##
```{r}
maxes = list()
max_ks = list()
```

```{r loop}

for (i in 0:100){
  #initialize the correlations table
  correlations = data.frame(Basis=character(),Correlation=double(),Kendall=double())
  #faceted_cors = data.frame(Condition=integer(),Correlation=double(),Basis=character())
  #we need to test if our model is doing any better than random...
  #let's scramble! (shuffles by condition and generalization)
  
  scrambled <- hp %>%
    group_by(condition, generalization) %>%
    mutate(probability=sample(probability))
  
  
  #now compare all the model bases to this scramble!
  for(f in list.files("ag/", full.names=TRUE)) {
   
      ag <- read.csv(f, header=TRUE)
      ag <- na.omit(ag)
      name = gsub("ag/", "",f)
      
      # what if our probability was proportional to the runtime
      
        if(length(scrambled$probability) == length(ag$model.probability)){
      
        #saving the correlations to a dataframe
        c = cor.test(scrambled$probability,ag$model.probability)
        k = cor.test(scrambled$probability,ag$model.probability,method="kendall")
        
        correlations <-rbind(correlations,data.frame(Basis=name,Correlation=c$estimate, Kendall=k$estimate))
        
        
        #cors <- ddply(na.omit(scrambled), c("condition"), summarise, cor = round(cor(scrambled$probability, ag$modprobability), 2))
        #cors$basis = name
        
        #put together the correlations by condition
        #faceted_cors = rbind(faceted_cors,cors)
        
       #View(faceted_cors)

        }
  }

  m = max(correlations$Correlation)
  mk = max(correlations$Kendall)
  maxes<-append(maxes,m)
  max_ks <-append(max_ks,mk)
  
  
  
  
  
      
}

```

```{r}
#Take a look at an example scrambled frame (technically, the last one called in the loop)
scrambled

#Take a look at an example ag frame (technically, the last one called in the loop)
ag

scramblemax_before<-data.frame(unlist(maxes))
mk_before<-data.frame(unlist(max_ks))
names(scramblemax_before) <-c("MaxCorrelations")
names(mk_before) <-c("MaxKendalls")

max_data <- as.data.frame(c(scramblemax_before,mk_before))
write.csv(max_data,"MaxtoScramble.csv")

```

```{r readin}
#the human correlations
correlations=read.csv("correlations.csv",header=TRUE)
correlations <-na.omit(correlations)

```

```{r}
#maximum correlations to random
scramblemax = read.csv("MaxtoScramble.csv",header=TRUE)

```

##Let's take a look at the distribution of max correlations now!##

```{r}
plt = ggplot(scramblemax, aes(x=MaxCorrelations)) + 
  geom_density()+
  ggtitle("Distribution of Correlations to Random Data")+
  xlab("Correlation")+
  ylab("Density")+
  geom_vline(data = correlations, aes(xintercept = max(correlations$cor),color="red"),linetype="dashed")+
  geom_text(aes(x=max(correlations$cor)-.02, label="Maximum Model Correlation to Human Data", y=3,angle=90))+
  theme_bw()+
  theme(legend.position="none")
  
plt
ggsave("MaxCorrelations.pdf",plt)

```



```{r p vals}
scramblemax$Better = FALSE
scramblemax$Better[scramblemax$MaxCorrelations >= max(correlations$Correlation)] = TRUE

num = length(scramblemax$Better[scramblemax$Better==TRUE]) #number of better than REAL human max correlation
denom = length(scramblemax$Better)#number of worse than REAL human max correlation

#p val for cor.test
num/length(scramblemax$Better)

```




